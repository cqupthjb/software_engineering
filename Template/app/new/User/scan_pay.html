<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<!-- 控制浏览器缓存 -->
		<meta http-equiv="Cache-Control" content="no-store" />
		<!-- 优先使用 IE 最新版本和 Chrome -->
		<!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />-->
		<!-- 页面描述 -->
		<meta name="description" content="商家支付页面" />
		<!-- 页面关键词 -->
		<meta name="keywords" content="{$store.store_name}" />
		<title>{$store.store_name}-商家支付</title>
		<link rel="stylesheet" href="__STATIC__/css/flow.css">
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			
			html,
			body {
				height: 100%;
				overflow: hidden;
			}

			input[type="button"], input[type="submit"], input[type="reset"] { -webkit-appearance: none; }
			
			.clearfix:after {
				content: "\200B";
				display: block;
				height: 0;
				clear: both;
			}
			
			.clearfix {
				*zoom: 1;
			}
			
			
			/*IE/7/6*/
			
			.shuru div::-webkit-scrollbar {
				width: 0;
				height: 0;
				-webkit-transition: 1s;
			}
			
			.shuru div::-webkit-scrollbar-thumb {
				background-color: #a7afb4;
				background-clip: padding-box;
				min-height: 28px;
			}
			
			.shuru div::-webkit-scrollbar-thumb:hover {
				background-color: #525252;
				background-clip: padding-box;
				min-height: 28px;
			}
			
			.shuru div::-webkit-scrollbar-track-piece {
				background-color: #ccd0d2;
			}
			
			.wrap {
				position: relative;
				margin: auto;
				max-width: 640px;
				min-width: 320px;
				width: 100%;
				height: 100%;
				background: #F0EFF5;
				overflow: hidden;
			}
			
			.layer-content {
				position: absolute;
				left: 50%;
				bottom: -200px;
				width: 100%;
				max-width: 640px;
				height: auto;
				z-index: 12;
				-webkit-transform: translateX(-50%);
				transform: translateX(-50%);
			}
			
			/* 输入表单 */
			
			.edit_cash {
				display: block;
				padding: 15px;
				margin: 0 auto;
				margin-top: 15px;
				width: 90%;
				border: 1px solid #CFCFCF;
				border-radius: 10px;
				background-color: #fff;
			}
			
			.edit_cash p {
				font-size: 14px;
				color: #8D8D8F;
			}
			
			.shuru {
				position: relative;
				margin-bottom: 10px;
			}
			
			.shuru div {
				border: none;
				width: 100%;
				height: 50px;
				font-size: 25px;
				line-height: 50px;
				border-bottom: 1px solid #CFCFCF;
				text-indent: 30px;
				outline: none;
				white-space: pre;
				overflow-x: scroll;
			}
			
			.shuru span {
				position: absolute;
				top: 10px;
				font-size: 25px;
			}
			
			.submit {
				display: block;
				margin: 20px auto 0;
				width: 90%;
				height: 40px;
				font-size: 16px;
				color: #fff;
				/*background: #80D983;*/
				background: #63C366;
				border: 1px solid #47D14C;
				border-radius: 3px;
			}
			
			
			/* 键盘 */
			
			.form_edit {
				width: 100%;
				background: #D1D4DD;
				display: none;
			}
			
			.form_edit> div {
				margin-bottom: 2px;
				margin-right: 0.5%;
				float: left;
				width: 33%;
				height: 45px;
				text-align: center;
				color: #333;
				line-height: 45px;
				font-size: 18px;
				font-weight: 600;
				background-color: #fff;
				border-radius: 5px;
			}
			
			.form_edit> div:nth-child(3n) {
				margin-right: 0;
			}
			
			.form_edit> div:last-child {
				background-color: #DEE1E9;
			}

			/*支付方式*/
			.mt10 {
				margin-top: 10px;
			}
			.g-Recharge li a, .g-Recharge li .z-initsel, .g-Recharge li b {
				color: #959595;width: 90%;
				line-height: 30px;display: inline-block;
				background: #fff;border-radius: 5px;
				text-align: center;border: 1px solid #EAEAEA;
				box-shadow: 1px 1px 1px #EDEDED; position: relative;
			}
			.z-sel s, .z-initsel s, .z-Btn-Close b, .z-Btn-Rotation b, .z-Btn-del b, .z-Btn-ok b {
				background: url(__STATIC__/images/member-icon.png?v=130825);background-size: 40px auto;
			}
			.z-bank-Round {
				width: 16px;
				height: 16px;border: 1px solid #bbb;
				background: #fff;border-radius: 16px;
				display: inline-block;margin-right: 8px;
				box-shadow: 0 1px 1px #ccc inset;
			}
			.z-bank-Roundsel s {
				width: 12px;height: 12px;border-radius: 12px;display: inline-block;
				background-image: -webkit-gradient(linear,left top,left bottom,color-stop(0,#ff8a00),color-stop(1,#f60));
			}
			.f-Recharge-btn {display: block;}
			a.orgBtn {background: #f60;border: 1px solid #ef6000;}
			.orgBtn {
				display: block; width: 100%;
				-webkit-box-sizing: border-box;
				height: 43px;line-height: 43px;
				text-align: center; color: #fff!important;
				border-radius: 5px;font-size: 18px;
			}
			.clearfix { display: block;}
			.z-bank-Roundsel {
				width: 16px;height: 16px;line-height: 20px;border: 1px solid #ccc;background: #F6F5F5;
				border-radius: 16px;display: inline-block;text-align: center;margin-right: 8px;
			}
			.g-pay-ment li {
				line-height: 36px;/*border-top: 1px dotted #CBCBCB;*/max-height: 40px;
				/*padding: 0 10px;*/overflow: hidden;margin-top: -1px;
			}
			.clearfix:after {
				content: ".";display: block;height: 0;clear: both;visibility: hidden;
			}
			.orange {color: #f60;}

			.shipping_title {
				height: 50px !important;
				line-height: 50px !important;
				margin: 5px auto;
			}
		</style>
	</head>
	<body>
		<div class="wrap">
			<form action="{:U('Payment/get_scan_pay')}" method="post" class="edit_cash" id="pay_form">
				<input type="hidden" name="type" value="app">
				<p>消费总额</p>
				<div class="shuru">
					<span>&yen;</span>
					<div id="div"></div>
				</div>
				<input type="hidden" name="account"/>
				<!--<input type="hidden" name="pay_code" value="weixin"/>-->
				<p>可询问工作人员应缴费用总额</p>
				<div class="clearfix mt10 m-round g-pay-ment g-bank-ct">
					<ul id="ulBankList" class="nav nav-list-sidenav">
						<li class="gray6">选择支付方式<em class="orange"></em></li>
						<foreach name="paymentList" item="v"  key="k">
							<li class="clearfix" name="payment_name">
								<label>
									<input type="radio" value="{$v['code']}" class="c_checkbox_t" name="pay_radio"/>
									<!--<if condition="$order[pay_code] eq $v[code]">checked</if>-->
									<div class="fl shipping_title">
										<img src="/plugins/{$v['type']}/{$v['code']}/{$v['icon']}" onClick="change_pay(this);" width="100" height="40" />
									</div>
								</label>
							</li>
						</foreach>
					</ul>
				</div>
			</form>
			<input type="button" value="支付" class="submit" />
		</div>
		<div class="layer"></div>
		<div class="layer-content">
			<div class="form_edit clearfix">
				<div class="num">1</div>
				<div class="num">2</div>
				<div class="num">3</div>
				<div class="num">4</div>
				<div class="num">5</div>
				<div class="num">6</div>
				<div class="num">7</div>
				<div class="num">8</div>
				<div class="num">9</div>
				<div class="num">.</div>
				<div class="num">0</div>
				<div id="remove">删除</div>
			</div>
		</div>
		<script src="__STATIC__/js/jquery.js"></script>
		<script type="text/javascript" src="http://apps.bdimg.com/libs/fastclick/1.0.0/fastclick.min.js"></script>
		<script>
            $(function() {
                FastClick.attach(document.body);
            });
            $(document).ready(function () {
                $("input[name='pay_radio']").first().trigger('click');
            });
            function change_pay(obj)
            {
                $(obj).parent().siblings('input[name="pay_radio"]').trigger('click');
            }
			$(function(){
				
				//填写信息
				$('.infor-sub').click(function(e){
					$('.layer').hide();
					$('.form').hide();
					e.preventDefault();		//阻止表单提交
				})
				// 监听#div内容变化，改变支付按钮的颜色
				$('#div').bind('DOMNodeInserted', function(){
					if($("#div").text()!="" || $("#div").text()>'0'){
						$('.submit').removeClass('active');
						$('.submit').attr('disabled', false);
					}else{
						$('.submit').addClass('active');
						$('.submit').attr('disabled', true);
					}
				})
				$('#div').trigger('DOMNodeInserted');
				
				$('.shuru').click(function(e){
                    if ($('.form_edit').css('display') == 'none'){
                        $('.form_edit').css('display','block');
                    }
					$('.layer-content').animate({
						bottom: 0
					}, 200)
					e.stopPropagation();
				})
				$('.wrap').click(function(){
                    $('.layer-content').animate({
                        bottom: '-200px'
                    }, 200)
                    setTimeout(function () {
                        if ($('.form_edit').css('display') == 'block'){
                            $('.form_edit').css({'display':'none'});
                        }
                    },300);
				})
				
				$('.form_edit .num').click(function(){
					var oDiv = document.getElementById("div");
					oDiv.innerHTML += this.innerHTML;
                    $('input[name="account"]').val(oDiv.innerHTML);
				})
				$('#remove').click(function(){
					var oDiv = document.getElementById("div");
					var oDivHtml = oDiv.innerHTML;
					oDiv.innerHTML = oDivHtml.substring(0,oDivHtml.length-1);
                    $('input[name="account"]').val(oDiv.innerHTML);
				})
			})
		</script>
		<script>
			$('.submit').on('click',function () {
				var money = parseFloat($('input[name="account"]').val());
                if (typeof (money) == 'undefined' || isNaN(money) || money <= 0 ){
                    return false;
                }
                //$('#pay_form').submit();
                var pay_code = $('input[name="pay_radio"]:checked').val();
                var url = "{:U('App/Payment/get_scan_pay')}";
                $.post(url,$('#pay_form').serialize(),function (ret) {
                    if (ret.hasOwnProperty('order_sn')){
                        if (pay_code == 'weixin'){
                            wx_pay_order("{$pay_url}",'scan_order',ret.order_sn,"{:U('User/scan_order_list')}",0);//微信支付
                        }else {
                            alipay_pay_order("{:U('Api/Payment/alipay')}",'scan_order',ret.order_sn,"{:U('User/scan_order_list')}",0);//微信支付
                        }
                    }else{
                        if(ret.hasOwnProperty('msg')){
                            api.alert({msg:ret.msg})
						}else{
                            api.alert({msg:'提交订单失败'});
						}
					}
                })

            })
		</script>
		<!--支付-->
		<include file="Public/pay_order"/>
		<include file="Public/footer"/>
	</body>
</html>
